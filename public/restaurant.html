<!doctype html>
<html lang="en">

<head>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no, maximum-scale=1">

  <title>Clarivore</title>
  <style>
    html,
    body {
      background: #0b1020;
    }

    #pageLoader {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      background: #0b1020;
      color: #e9ecff;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    #pageLoader.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #pageLoader img {
      width: 72px;
      height: 72px;
    }

    #pageLoader .pageLoaderSpinner {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid rgba(233, 236, 255, 0.2);
      border-top-color: #7c9cff;
      animation: pageLoaderSpin 1s linear infinite;
    }

    @keyframes pageLoaderSpin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
  <script>
    (function () {
      var search = window.location.search || "";
      var enable =
        search.indexOf("debug=1") !== -1 ||
        (function () {
          try {
            return localStorage.getItem("enableConsoleReporting") === "true";
          } catch (e) {
            return false;
          }
        })() ||
        window.__enableConsoleReporting === true;
      window.__enableConsoleReporting = enable;
      if (!enable && typeof console !== "undefined") {
        console.log = function () {};
        console.info = function () {};
        console.warn = function () {};
        console.debug = function () {};
      }
    })();
  </script>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script src="https://docs.opencv.org/4.5.2/opencv.js" type="text/javascript"></script>
  <link rel="stylesheet" href="css/styles.css">
</head>

<body>
  <div id="pageLoader" role="status" aria-live="polite" aria-label="Loading">
    <img src="favicon.png" alt="Clarivore">
    <div class="pageLoaderSpinner" aria-hidden="true"></div>
  </div>
  <div class="wrap">
    <header class="simple-topbar" id="topbarOuter">
      <div class="simple-topbar-inner" id="topbar">
        <div class="mode-toggle-container" id="modeToggleContainer" style="display:none"></div>
      </div>
    </header>
    <div class="content" id="root"></div>
  </div>

  <div class="tip" id="tip"></div>

  <div class="orderSidebar" id="orderSidebar">
    <div class="orderSidebarHeader">
      <div class="orderSidebarDragHandle" id="orderSidebarDragHandle">
        <span class="orderSidebarDragBar"></span>
        <span class="orderSidebarDragLabel">Drag</span>
      </div>
      <div class="orderSidebarHeaderRow">
        <div class="orderSidebarTitleWrap">
          <h3 class="orderSidebarTitle">My order dashboard</h3>
          <span class="orderSidebarBadge" id="orderSidebarBadge" hidden>0</span>
        </div>
        <button type="button" class="orderSidebarRefreshBtn" id="orderSidebarRefreshBtn" title="Refresh order status"
          style="background:rgba(76,90,212,0.3);border:1px solid rgba(76,90,212,0.5);border-radius:6px;padding:6px 10px;color:#a5b4fc;cursor:pointer;font-size:0.85rem;font-weight:600;transition:all 0.2s">‚Üª</button>
      </div>
    </div>
    <div class="orderSidebarContent" id="orderSidebarContent">
      <div class="orderSidebarStatus" id="orderSidebarStatus" hidden style="display:none!important">
        <div class="orderSidebarStatusHeader">
          <span class="orderSidebarStatusTitle">Allergy notice status</span>
          <span class="orderSidebarStatusBadge orderConfirmStatusBadge" id="orderSidebarStatusBadge"
            data-tone="idle">Waiting for server code</span>
        </div>
      </div>
      <div class="orderSidebarItems" id="orderSidebarItems"></div>
      <div class="orderSidebarActions" id="orderSidebarActions">
        <button type="button" class="confirmOrderBtn" id="confirmOrderBtn">Proceed to confirmation</button>
        <div class="confirmOrderHint" id="confirmOrderHint" hidden>
          <span>(check the box next to any dishes you would like to proceed with)</span>
        </div>
      </div>
    </div>
  </div>

  <div class="orderConfirmDrawer" id="orderConfirmDrawer" aria-hidden="true">
    <div class="orderConfirmPanel" role="dialog" aria-labelledby="orderConfirmHeading" aria-modal="true">
      <header class="orderConfirmHeader">
        <h2 id="orderConfirmHeading">Send allergy &amp; diet notice</h2>
        <button class="orderConfirmClose" id="orderConfirmClose" type="button"
          aria-label="Close confirmation window">√ó</button>
      </header>
      <div class="orderConfirmLayout">
        <section class="orderConfirmPrimary">
          <div class="orderConfirmSection" id="orderConfirmSummarySection">
            <div>
              <h3>Review your order</h3>
              <ul class="orderConfirmSummaryList" id="orderConfirmSummaryList"></ul>
              <p class="orderConfirmEmpty" id="orderConfirmEmptySummary" hidden>No dishes selected yet.</p>
            </div>
          </div>

          <form class="orderConfirmSection orderConfirmForm" id="orderConfirmForm" autocomplete="off">
            <h3>Diner details</h3>
            <label>
              <span>Your name</span>
              <input id="orderConfirmName" name="orderConfirmName" type="text" placeholder="e.g. John Doe" required>
            </label>
            <div class="orderConfirmRadioGroup" role="group" aria-label="Dining mode">
              <label>
                <input type="radio" name="orderConfirmMode" value="dine-in" checked>
                <span>Dine-in</span>
              </label>
              <label>
                <input type="radio" name="orderConfirmMode" value="delivery">
                <span>Delivery / pickup</span>
              </label>
            </div>
            <div class="orderConfirmConditional">
              <div data-mode="delivery" id="deliveryButtonContainer" hidden>
                <a id="deliveryLinkButton" class="btn btnPrimary" target="_blank"
                  style="display: inline-flex; align-items: center; gap: 6px; text-decoration: none; width: 100%; justify-content: center;">
                  <span>üöó Order Delivery / Pickup</span>
                </a>
              </div>
            </div>
            <div>
              <span>Allergies</span>
              <div class="orderConfirmChips" id="orderConfirmAllergyChips"></div>
            </div>
            <div>
              <span>Diets</span>
              <div class="orderConfirmChips" id="orderConfirmDietChips"></div>
            </div>
            <label>
              <span>Additional notes for the kitchen</span>
              <textarea id="orderConfirmNotes" name="orderConfirmNotes" rows="3" placeholder="Optional"></textarea>
            </label>
            <div class="orderConfirmCodeBlock" id="orderConfirmCodeBlock">
              <div id="dineInCodeSection">
                <p>
                  When your server is ready, they'll share a code that combines their four-digit server ID with your
                  table number.
                  Enter it below to confirm your notice to the server tablet.
                </p>
                <label>
                  <span>Enter the code from your server</span>
                  <input id="orderConfirmCodeInput" name="orderConfirmCodeInput" type="text" inputmode="numeric"
                    maxlength="8" placeholder="#### + table">
                </label>
              </div>
              <div id="deliveryMessageSection"
                style="display: none; padding: 16px; background: rgba(220, 82, 82, 0.1); border: 1px solid rgba(220, 82, 82, 0.3); border-radius: 8px; margin-bottom: 16px;">
                <p style="color: #dc5252; margin: 0; font-weight: 600; line-height: 1.5;">‚ö†Ô∏è Please make sure you've
                  placed your order with the delivery service before submitting the notice.</p>
              </div>
              <div class="orderConfirmAuthPrompt" id="orderConfirmAuthPrompt" style="display: none;">
                <p class="orderConfirmAuthText">You need to sign in or create a free account to submit your notice.</p>
                <div class="orderConfirmAuthButtons">
                  <button type="button" class="orderConfirmAuthBtn orderConfirmSignInBtn"
                    id="orderConfirmSignInBtn">Sign in</button>
                  <button type="button" class="orderConfirmAuthBtn orderConfirmSignUpBtn"
                    id="orderConfirmSignUpBtn">Create account</button>
                </div>
              </div>
              <div class="orderConfirmActions">
                <button type="button" class="orderConfirmPrimaryBtn" id="orderConfirmSubmitBtn" disabled>Submit
                  notice</button>
                <div class="orderConfirmStatusText" id="orderConfirmSubmitStatus" role="status" aria-live="polite">
                </div>
              </div>
            </div>
          </form>

          <div class="orderConfirmActions">
            <button type="button" class="orderConfirmSecondaryBtn orderConfirmReset" id="orderConfirmResetBtn"
              hidden>Start another notice</button>
          </div>
        </section>

        <aside class="orderConfirmAside" hidden></aside>
      </div>
    </div>
  </div>

  <div class="modalBack" id="modalBack">
    <div class="modal">
      <button class="modalCloseBtn" id="modalCloseBtn" type="button">√ó</button>
      <div class="head">
        <div id="modalTitle">Edit item</div>
      </div>
      <div class="body" id="modalBody"></div>
    </div>
  </div>

  <div class="photoModal" id="photoModal">
    <div class="photoModalClose" id="photoModalClose">√ó</div>
    <img id="photoModalImage" src="" alt="Confirmation photo">
  </div>

  <div class="qrPromoBackdrop" id="qrPromoBackdrop" aria-hidden="true">
    <div class="qrPromo" role="dialog" aria-labelledby="qrPromoTitle" aria-modal="true">
      <button class="qrPromoClose" id="qrPromoClose" type="button" aria-label="Close promotion">√ó</button>
      <h2 id="qrPromoTitle">Check out all restaurants part of Clarivore</h2>
      <p>Save your allergens and diets once and unlock curated menus at restaurants across the city.</p>
      <p>Creating an account takes less than a minute and is completely free.</p>
      <button class="btn btnPrimary" id="qrPromoSignup" type="button">Create free account</button>
    </div>
  </div>

  <!-- Manager Invite Banner -->
  <div class="managerInviteBanner" id="managerInviteBanner" style="display:none;">
    <div class="managerInviteBanner-content">
      <div class="managerInviteBanner-icon">üîë</div>
      <div class="managerInviteBanner-text">
        <strong>You've been invited as a Manager</strong>
        <span>Sign up to activate your manager access to this restaurant</span>
      </div>
    </div>
    <button class="btn btnPrimary" id="managerInviteSignupBtn" type="button">Sign up to activate access</button>
  </div>

  <!-- Editor Lock Modal -->
  <div class="editorLockBackdrop" id="editorLockBackdrop" style="display:none;">
    <div class="editorLockModal" role="dialog" aria-modal="true" aria-labelledby="editorLockTitle">
      <div class="editorLockIcon">üîí</div>
      <h2 id="editorLockTitle">Editor Currently in Use</h2>
      <p class="editorLockMessage">
        <span id="editorLockUser">Another user</span> is currently editing this restaurant's menu.
      </p>
      <p class="editorLockSince">Editing since: <span id="editorLockSince">--</span></p>
      <p class="editorLockInfo">To avoid conflicts, only one person can edit at a time. The editor will become available
        when they finish or after 2 minutes of inactivity.</p>
      <div class="editorLockActions">
        <button class="btn btnPrimary" id="editorLockRefresh" type="button">Check again</button>
      </div>
      <div style="margin-top:16px;">
        <a href="/manager-dashboard.html" class="btn btnSecondary" style="text-decoration:none;display:inline-block;">Go
          to Dashboard</a>
      </div>
    </div>
  </div>

  <!-- Mobile Zoom UI Elements -->
  <div class="zoomTopOverlay" id="zoomTopOverlay"></div>

  <!-- Zoomed Dish Info Panel -->
  <div class="zoomedDishInfo" id="zoomedDishInfo">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
      <button class="zoomBackButton" id="zoomBackButton" type="button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
          stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <h3 id="zoomedDishName" style="margin: 0;">Dish Name</h3>
    </div>
    <div class="allergenChips" id="zoomedAllergenChips"></div>
    <div class="zoomedDishActions" id="zoomedDishActions"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/auth-redirect.js" defer></script>
  <script src="js/allergen-diet-config.js"></script>
  <script type="module" src="js/restaurant-boot.js"></script>
  <script type="module" src="js/restaurant-page.js"></script>
</body>

</html>
