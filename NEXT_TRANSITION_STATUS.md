# Next.js Transition Status

## What is now Next-first
- Web app routes are provided by the Next app router (`/app/*`).
- Internal auth and navigation redirects now use Next routes on web.
- Vercel config is Next-first (`vercel.json`).
- Capacitor now uses Next export output (`webDir: "out"`).
- `cap:copy` and `cap:sync` now build Next before copying/syncing.

## Simplifications completed
- Shared route fallback UI extracted to `app/components/RouteSuspense.js`.
- Shared "last confirmed" formatting extracted to `app/lib/confirmationAge.js`.
- Duplicate Supabase client bootstraps removed in key pages.
- Hardcoded Supabase credentials removed from `api/ai-proxy.js` in favor of env vars.
- `report-issue`, `my-dishes`, `order-feedback`, `kitchen-tablet`, `server-tablet`, `admin-dashboard`, `manager-dashboard`, and `help-contact` no longer depend on legacy `/js/shared-nav.js`.
- App-level `shared-nav` imports are now fully removed.
- `restaurant` runtime entry points are app-local modules (`app/restaurant/runtime/*` + `app/lib/restaurantRuntime/*`) instead of `/public/js/*` URL imports.
- App-level `webpackIgnore` imports are fully removed.
- Shared notification/allergen helpers moved into app modules:
  - `app/lib/orderNotifications.js`
  - `app/lib/managerNotifications.js`
  - `app/lib/allergenConfigRuntime.js`
- Removed redundant dashboard fallback imports and files from app-local legacy trees:
  - `admin-dashboard` legacy tree reduced to 0 files
  - `manager-dashboard` legacy tree reduced to 0 files
- Consolidated duplicated manager chat notification logic into `app/lib/chatNotifications.js`.
- Consolidated help-assistant drawer logic through shared app module usage (`app/lib/sharedNav.js` imports `app/lib/helpAssistantDrawer.js`).
- Introduced shared topbar components in `app/components/SimpleTopbar.js`:
  - `SimpleTopbar` for common brand/nav/auth shell
  - `ManagerModeSwitch` for editor/customer mode toggles
- Refactored 14 app routes/components to use shared `SimpleTopbar`, including restaurant shell compatibility usage.
- Raw app-level `simple-topbar` markup is now fully removed from page components.
- Added shared topbar link builders in `app/lib/topbarLinks.js`:
  - `createDinerTopbarLinks`
  - `createTabletMonitorTopbarLinks`
- Refactored diner/tablet routes to consume shared topbar link builders instead of page-local duplicated link arrays (`home`, `restaurants`, `favorites`, `dish-search`, `help-contact`, `report-issue`, `my-dishes`, `order-feedback`, `account`, `kitchen-tablet`, `server-tablet`).
- Introduced shared tablet monitor layout components in `app/components/TabletMonitorLayout.js`:
  - `TabletMonitorPage`
  - `TabletMonitorHeader`
  - `TabletEmptyState`
- Refactored both tablet monitor routes (`kitchen-tablet`, `server-tablet`) to use shared monitor layout components.
- Introduced shared restaurant card component in `app/components/RestaurantCard.js`.
- Refactored `home`, `restaurants`, and `favorites` to render the same shared restaurant card UI component.
- Introduced shared restaurant list state component in `app/components/RestaurantGridState.js`.
- Refactored `home`, `restaurants`, and `favorites` to reuse one shared status/loading/empty + grid rendering component instead of duplicating page-local list markup.
- Removed duplicated route-level inline restaurant card CSS from `app/restaurants/head.js` in favor of shared stylesheet classes.
- Removed the final app-level legacy runtime Supabase bridge and legacy runtime folder:
  - `app/runtime/legacy/supabase-client.js` (removed)
  - `app/runtime/legacy` (removed)
- Added shared owner/manager access helpers in `app/lib/managerRestaurants.js`:
  - `isOwnerUser`
  - `isManagerUser`
  - `isManagerOrOwnerUser`
  - `resolveManagerRestaurantAccess`
- Refactored access checks across key routes/services to use shared helpers (`account`, `report-issue`, `order-feedback`, `help-contact`, `dish-search`, `kitchen-tablet`, `server-tablet`, `manager-dashboard`, `admin-dashboard`, `restaurantBootService`).
- Added shared tablet order persistence helpers in `app/lib/tabletOrderPersistence.js`:
  - `cloneTabletOrder`
  - `fetchAccessibleTabletOrders`
  - `upsertTabletOrder`
  - `notifyDinerNoticeUpdate`
- Refactored both tablet monitor routes (`kitchen-tablet`, `server-tablet`) to use shared tablet order persistence helpers.
- Replaced `admin-dashboard` legacy runtime boot (`app/admin-dashboard/runtime/legacy/admin-dashboard-page.js`) with native React/Next stateful UI in `app/admin-dashboard/components/AdminDashboardDom.js`.
- Removed all app-local admin legacy runtime files (`app/admin-dashboard/runtime/legacy/*`).
- Removed `manager-dashboard` legacy floating report modal runtime import/file (`app/manager-dashboard/runtime/legacy/report-modal.js`) in favor of existing Next-native reporting/help routes.
- Removed `manager-dashboard` legacy orchestration runtime (`app/manager-dashboard/runtime/legacy/manager-dashboard.js`) and local bridge re-export (`app/manager-dashboard/runtime/legacy/supabase-client.js`).
- Removed remaining manager-specific ingredient capture runtimes (`app/manager-dashboard/runtime/legacy/ingredient-label-capture.js`, `app/manager-dashboard/runtime/legacy/ingredient-allergen-analysis.js`).
- Added shared manager ingredient capture bridge `app/lib/managerIngredientPhotoCapture.js`.
- Added shared ingredient label analysis helper `app/lib/ingredientAllergenAnalysis.js`.
- Removed restaurant-local legacy Supabase bridge (`app/restaurant/runtime/legacy/supabase-client.js`); legacy restaurant notification/order modules now consume shared `app/lib/supabase.js`.
- Moved diner notification bootstrap into shared app module `app/lib/dinerNotifications.js` and updated restaurant runtime imports.
- Moved tablet order persistence/bootstrap API into shared app module `app/lib/tabletOrdersApi.js` and updated restaurant runtime imports.
- Moved tablet sync transport helpers into shared app module `app/lib/tabletSync.js` and updated restaurant runtime imports.
- Moved tablet simulation logic into shared app module `app/lib/tabletSimulationLogic.mjs` and updated restaurant runtime imports.
- Moved shared navigation runtime helper into `app/lib/sharedNav.js` and updated restaurant runtime imports.
- Added shared chat message parsing/rendering primitives:
  - `app/lib/chatMessage.js`
  - `app/components/chat/ChatMessageText.js`
- Refactored both admin and manager dashboards to reuse shared chat message rendering instead of duplicated inline parsers/components.
- Added shared user identity/name resolution helpers in `app/lib/userIdentity.js`:
  - `resolveAccountName`
  - `resolveManagerDisplayName`
  - `resolveGreetingFirstName`
- Refactored `help-contact`, `report-issue`, `home`, `manager-dashboard`, and key restaurant runtime utilities to consume shared user identity helpers instead of duplicated local resolvers.
- Added shared chat timestamp formatting in `app/lib/chatMessage.js` (`formatChatTimestamp`) and refactored `help-contact`, `admin-dashboard`, and `manager-dashboard` chat UIs to consume it.
- Refactored `help-contact` chat message rendering to use shared `ChatMessageText` instead of local HTML string formatting.
- Moved reusable ingredient/time runtime utilities out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/ingredientPhotoAnalysis.js`
  - `app/lib/ingredientNormalizer.js`
  - `app/lib/timeFormatting.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/ingredient-photo.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/ingredient-row-utils.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/time-formatting.js` (removed)
- Moved additional pure service/normalization utilities out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/changeLogService.js`
  - `app/lib/restaurantNormalization.js`
  - `app/lib/ingredientSources.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/change-log-service.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-normalization.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/ingredient-sources.js` (removed)
- Added shared restaurant visibility rules in `app/lib/restaurantVisibility.js`:
  - `getRestaurantLastConfirmedDate`
  - `isRestaurantRecentlyConfirmed`
  - `filterRestaurantsByVisibility`
- Refactored `home`, `restaurants`, `favorites`, and restaurant runtime message/cards flows to consume shared visibility filtering logic.
- Expanded shared manager role detection in `app/lib/managerRestaurants.js` (`isManagerUser`) to support both `user.user_metadata.role` and legacy `user.role` payloads.
- Moved additional restaurant runtime view orchestration modules into shared app modules:
  - `app/lib/restaurantMessageHandler.js`
  - `app/lib/restaurantFiltersRuntime.js`
  - `app/lib/restaurantTopbarRuntime.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/restaurant-message.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-filters.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-cards-page.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-topbar.js` (removed)
- Retired legacy in-runtime restaurant cards page rendering; router now sends `state.page === "restaurants"` to Next route `/restaurants` (preserving QR/invite query context).
- Moved additional restaurant shell/report/editor view helpers out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/restaurantChangeLogRuntime.js`
  - `app/lib/editorLastConfirmedRuntime.js`
  - `app/lib/editorShellMarkup.js`
  - `app/lib/reportShellMarkup.js`
  - `app/lib/restaurantShellMarkup.js`
  - `app/lib/restaurantReportPageRuntime.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/change-log.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/editor-last-confirmed.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/editor-shell-markup.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/report-shell-markup.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-shell-markup.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-report-page.js` (removed)
- Moved hydration/boot leaf helpers out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/autoOpenDishRuntime.js`
  - `app/lib/bootHydrationRuntime.js`
  - `app/lib/orderConfirmRestoreRuntime.js`
- Updated hydration runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/auto-open-dish.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/boot-hydration-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/order-confirm-restore.js` (removed)
- Moved additional restaurant runtime orchestration modules out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/restaurantNavigationRuntime.js`
  - `app/lib/standaloneMessageDispatcher.js`
  - `app/lib/pageCoreRuntime.js`
  - `app/lib/pageOffsetRuntime.js`
  - `app/lib/pageUtilsRuntime.js`
  - `app/lib/pageUiOptionsRuntime.js`
  - `app/lib/pageUiRuntime.js`
  - `app/lib/pageRouterRuntime.js`
  - `app/lib/editorRuntime.js`
  - `app/lib/unsavedChangesRuntime.js`
  - `app/lib/unsavedGuardRuntime.js`
  - `app/lib/hydrationRuntime.js`
  - `app/lib/pageEditorHydrationOptionsRuntime.js`
  - `app/lib/pageEditorHydrationRuntime.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/navigation-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/standalone-message-dispatcher.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-core-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-offset-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-utils-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-ui-options.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-ui-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-router-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/editor-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/unsaved-changes.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/unsaved-guard-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/hydration-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-editor-hydration-options.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/page-editor-hydration-runtime.js` (removed)
- Moved additional restaurant view/service helper modules out of `app/restaurant/runtime/legacy` into shared app modules:
  - `app/lib/pageServicesRuntime.js`
  - `app/lib/mobileInfoHelpersRuntime.js`
  - `app/lib/restaurantViewBindings.js`
- Updated restaurant runtime imports to consume those shared modules and removed legacy duplicates:
  - `app/restaurant/runtime/legacy/restaurant/page-services-runtime.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/mobile-info-helpers.js` (removed)
  - `app/restaurant/runtime/legacy/restaurant/restaurant-view.js` (removed)
- Consolidated the remaining route-level page frame markup into a shared component:
  - `app/components/PageShell.js`
- Refactored additional routes to use the shared page shell layout instead of duplicating `page-shell/page-main/page-content` wrappers:
  - `app/home/HomeClient.js`
  - `app/restaurants/RestaurantsClient.js`
  - `app/favorites/FavoritesClient.js`
  - `app/dish-search/DishSearchClient.js`
  - `app/my-dishes/MyDishesClient.js`
  - `app/order-feedback/OrderFeedbackClient.js`
  - `app/help-contact/HelpContactClient.js`
  - `app/report-issue/ReportIssueClient.js`
- Refactored remaining non-tablet route holdouts to use shared page shell structure:
  - `app/account/AccountClient.js`
  - `app/admin-dashboard/components/AdminDashboardDom.js`
  - `app/manager-dashboard/components/ManagerDashboardDom.js`
- Removed redundant outer `page-shell` wrappers around tablet monitor pages; shared `TabletMonitorPage` now owns page shell markup:
  - `app/kitchen-tablet/KitchenTabletClient.js`
  - `app/server-tablet/ServerTabletClient.js`
- Began decomposing `restaurant` monolithic runtime bootstrap into reusable modules/hooks:
  - added `app/restaurant/runtime/runtimeEnvironment.js` for debug bridge, viewport setup, and runtime collection initialization
  - added `app/restaurant/hooks/useRestaurantRuntimeEnvironment.js`
  - wired `app/restaurant/RestaurantClient.js` and `app/restaurant/hooks/useRestaurantRuntime.js` to initialize runtime environment via shared helper/hook
  - removed inline runtime environment bootstrapping code from `app/restaurant/runtime/restaurantPageRuntime.js`
- Continued decomposing `restaurant` runtime orchestration into focused bootstrap modules:
  - added `app/restaurant/runtime/createRestaurantRuntimeCore.js` (page services + dish editor core wiring)
  - added `app/restaurant/runtime/createRestaurantPageUiBundle.js` (page UI option/runtime composition)
  - added `app/restaurant/runtime/createRestaurantEditorHydrationBundle.js` (editor/hydration bundle composition)
  - updated `app/restaurant/runtime/restaurantPageRuntime.js` to consume these modules instead of inlining all orchestration setup
- Added shared restaurant runtime bridge state module `app/lib/restaurantRuntime/restaurantRuntimeBridge.js` to centralize cross-module globals and progressively replace direct `window.*` coupling for:
  - overlay detail callbacks + layer rerender (`showOverlayDetails`, `__rerenderLayer__`)
  - mobile info panel/render state (`renderMobileInfo`, `currentMobileInfoItem`, `__lastSelectedOverlay`)
  - editor/deep-link/open-on-load flags (`__startInEditor`, `__pendingDishToOpen`, `__pendingIngredientToScroll`, `__openLogOnLoad`, `__openConfirmOnLoad`)
  - editor modal/change-log callbacks (`openBrandVerification`, `displayChangeLog`)
- Refactored key restaurant runtime modules to consume bridge APIs instead of direct `window` globals:
  - `app/restaurant/boot/pageFlags.js`
  - `app/restaurant/restaurantBootService.js`
  - `app/lib/pageServicesRuntime.js`
  - `app/lib/restaurantRuntime/order-runtime.js`
  - `app/lib/restaurantRuntime/order-flow.js`
  - `app/lib/pageUiOptionsRuntime.js`
  - `app/lib/restaurantRuntime/overlay-ui-runtime.js`
  - `app/lib/restaurantRuntime/tooltip-runtime.js`
  - `app/lib/autoOpenDishRuntime.js`
  - `app/lib/restaurantMessageHandler.js`
  - `app/lib/restaurantChangeLogRuntime.js`
  - `app/lib/restaurantRuntime/menu-draw-runtime.js`
  - `app/lib/restaurantRuntime/mobile-viewer-runtime.js`
  - `app/lib/restaurantRuntime/mobile-info-panel-runtime.js`
  - `app/lib/restaurantRuntime/mobile-overlay-zoom.js`
  - `app/lib/restaurantRuntime/editor-runtime-bindings.js`
  - `app/lib/restaurantRuntime/editor-pending-dish.js`
  - `app/lib/restaurantRuntime/dish-editor.js`
  - `app/restaurant/runtime/restaurantPageRuntime.js`
- Removed obsolete restaurant runtime hydration fallback in `app/restaurant/hooks/useRestaurantRuntime.js`; the Next runtime now directly hydrates through `restaurantPageRuntime` export only.
- Removed legacy-only local dev server command (`dev:legacy`) from `package.json`.
- Removed the final app-local `restaurant` runtime legacy entrypoint:
  - moved `app/restaurant/runtime/legacy/restaurant-page.js` to `app/restaurant/runtime/restaurantPageRuntime.js`
  - updated `app/restaurant/runtime/scriptLoader.js` to import `./restaurantPageRuntime.js`
- Moved the remaining legacy restaurant runtime feature subtree into shared app modules under:
  - `app/lib/restaurantRuntime/*`
- Expanded shared runtime bridge/session state coverage to centralize editor session globals and cross-surface runtime state:
  - added bridge-managed editor session keys for dirty state, menu override buffers, save-review control, and mini-map resize handler in `app/lib/restaurantRuntime/restaurantRuntimeBridge.js`
  - added bridge-managed collector + callback wiring (`setCollectAllBrandItems`, `setUpdateOriginalRestaurantSettings`) to avoid direct global function mutation
  - fixed `restaurantBootService` to use `setSupabaseClient` from `runtimeSessionState` (instead of importing from the wrong module)
- Refactored editor/runtime modules to consume bridge APIs instead of direct `window.__editor*` / `window.editorDirty` globals:
  - `app/lib/restaurantRuntime/editor-session.js`
  - `app/lib/restaurantRuntime/editor-exit.js`
  - `app/lib/restaurantRuntime/editor-screen.js`
  - `app/lib/restaurantRuntime/editor-save.js`
  - `app/lib/restaurantRuntime/editor-sections.js`
  - `app/lib/restaurantRuntime/editor-toolbar.js`
  - `app/lib/restaurantRuntime/editor-history-controls.js`
  - `app/lib/restaurantRuntime/menu-images.js`
  - `app/lib/restaurantRuntime/dish-editor.js`
  - `app/lib/restaurantMessageHandler.js`
  - `app/restaurant/runtime/restaurantPageRuntime.js`
- Continued reducing runtime-wide direct `window.supabaseClient` coupling by routing read/write paths through shared session state:
  - `app/lib/changeLogService.js`
  - `app/lib/standaloneMessageDispatcher.js`
  - `app/lib/allergenConfigRuntime.js`
  - `app/restaurant/runtime/scriptLoader.js`
  - `app/lib/restaurantRuntime/feedback-modals.js`
  - `app/lib/restaurantRuntime/editor-settings.js`
  - `app/lib/ingredientAllergenAnalysis.js`
  - `app/lib/managerNotifications.js`
  - `app/lib/chatNotifications.js`
  - `app/lib/helpAssistantDrawer.js`
  - `app/lib/managerIngredientPhotoCapture.js`
  - `app/admin-dashboard/AdminDashboardClient.js`
  - `app/manager-dashboard/ManagerDashboardClient.js`
  - `app/kitchen-tablet/KitchenTabletClient.js`
  - `app/server-tablet/ServerTabletClient.js`
- Added shared allergen config accessor `getActiveAllergenDietConfig` in `app/lib/allergenConfigRuntime.js` and refactored runtime consumers to use it:
  - `app/restaurant/runtime/restaurantPageRuntime.js`
  - `app/lib/restaurantRuntime/order-flow.js`
  - `app/manager-dashboard/components/ManagerDashboardDom.js`
- Removed more editor runtime global state by migrating AI recipe photo/session behavior off `window` globals:
  - added `getAiAssistPhotos` / `setAiAssistPhotos` / `clearAiAssistPhotos` in `app/lib/restaurantRuntime/runtimeSessionState.js`
  - refactored `app/lib/restaurantRuntime/dish-editor-photos.js` to use shared session state and local event listeners (no inline `onclick` global remover handler)
  - refactored `app/lib/restaurantRuntime/dish-editor.js` to stop using `window.aiAssistPhotos`, `window.updateGenerateButtonText`, and unnecessary global exports for local helpers
- Centralized overlay pulse callback wiring through shared bridge state:
  - added `setOverlayPulseColorHandler` / `applyOverlayPulseColor` in `app/lib/restaurantRuntime/restaurantRuntimeBridge.js`
  - updated `app/restaurant/runtime/restaurantPageRuntime.js`, `app/lib/restaurantRuntime/order-flow.js`, and `app/lib/restaurantMessageHandler.js` to use bridge APIs instead of direct `window.setOverlayPulseColor`
- Reduced additional editor bootstrap globals:
  - removed direct `window.openItemEditor` export in `app/lib/restaurantRuntime/editor-runtime-bindings.js`
  - moved console-reporting preference state to bridge-managed flag (`setEnableConsoleReporting` / `getEnableConsoleReporting`) in:
    - `app/restaurant/boot/pageFlags.js`
    - `app/restaurant/runtime/runtimeEnvironment.js`
- Finished image-modal de-globalization in brand verification/editor flows:
  - replaced the last inline `openImageModal(...)` usage in `app/lib/restaurantRuntime/brand-verification.js` with data attributes and local event listeners
  - retained `openImageModal` as an injected runtime dependency instead of a global function export
- Removed remaining app-runtime inline click handlers in modal flows:
  - `app/lib/restaurantRuntime/brand-verification.js`
  - `app/lib/restaurantRuntime/editor-settings.js`
  - `app/lib/restaurantRuntime/feedback-modals.js`
  - `app/lib/restaurantRuntime/menu-images.js`
- Removed remaining inline click handlers in shared change-log runtime:
  - `app/lib/restaurantChangeLogRuntime.js` now binds close/details/photo-preview/restore actions via data attributes and event listeners
- Reduced change-log/photo-preview global coupling:
  - `app/lib/restaurantRuntime/editor-screen.js` now wires `showPhotoPreview` from `initChangeLog` into `initBrandVerification`
  - `app/lib/restaurantChangeLogRuntime.js` no longer exports `showPhotoPreview` / `restoreFromLog` on `window`
- Standardized app-side navigation assumptions to Next routes (no `.html` fallback checks) in:
  - `app/lib/helpAssistantDrawer.js`
  - `app/lib/sharedNav.js`
- Updated backend route normalization to Next-first paths:
  - tightened `shouldExposeUrl` in `supabase/functions/help-assistant/index.ts` to canonical path/clarivore URLs
  - switched monitoring migration menu URLs to `https://clarivore.org/restaurant?slug=...` in:
    - `supabase/migrations/20251022_enable_monitoring.sql`
    - `supabase/migrations/20251022000001_fix_monitoring_slugs.sql`

## Current migration inventory
- Legacy static HTML pages still present in `public/`: 15
- Legacy runtime JS files in `public/js/`: 108
- Next clients still booting legacy runtime modules via `/js/*`: 0 imports
- App-level `webpackIgnore` imports: 0
- Inline `onclick` handlers in `app/*`: 0
- App-side `.html` route references in `app/*`: 0
- App-local legacy runtime files:
  - `app/admin-dashboard/runtime/legacy`: 0
  - `app/manager-dashboard/runtime/legacy`: 0
  - `app/restaurant/runtime/legacy`: 0
- App routes still rendering raw topbar markup directly: 0
- App routes still rendering direct raw `page-shell` wrappers: 0 (excluding `RouteSuspense` fallback UI)
- Remaining `window.*` references in `app/lib/restaurantRuntime` + `app/restaurant/runtime`: 73 (down from 122 in prior pass)

## Remaining high-priority work
1. Replace the monolithic `restaurant` runtime entry (`app/restaurant/runtime/restaurantPageRuntime.js`) with native React/Next feature modules page-by-page.
2. Continue reducing global window-coupled runtime state in `app/lib/restaurantRuntime/*` into testable app-level services/hooks.
3. Retire `public/*.html` and unused `public/js/*` runtime files after parity, leaving only static assets.

## Validation commands
- `npm run build`
- `npm run cap:copy`
